--[[   
AUTO COLLECT + SELECTABLE HERBS (NO KEY)
]]--

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local StarterPlayer = game:GetService("StarterPlayer")
local CoreGui = game:GetService("CoreGui")

local LP = Players.LocalPlayer
local Character = LP.Character or LP.CharacterAdded:Wait()
local HRP = Character:WaitForChild("HumanoidRootPart")

-- ลบ GUI เก่า
if CoreGui:FindFirstChild("AUTO_COLLECT_UI") then CoreGui.AUTO_COLLECT_UI:Destroy() end

-- ==============================
-- AUTO COLLECT SETUP
-- ==============================
local HerbCache = {}
local TWEEN_SPEED = 70
local isTweening = false

local HerbsList = {
    "Soul Berries", "Extreme Yang Grass", "Immortal Peach",
    "Ginseng", "Soothing Soul Root", "Sorrowful Poison Drip"
}

local AutoEnabled = false
local HerbEnabled = {}
for _,name in pairs(HerbsList) do
    HerbEnabled[name] = false
end

-- สร้าง UI AutoCollect
local AutoGui = Instance.new("ScreenGui", CoreGui)
AutoGui.Name = "AUTO_COLLECT_UI"
AutoGui.ResetOnSpawn = false

local Frame2 = Instance.new("Frame", AutoGui)
Frame2.Size = UDim2.new(0, 250, 0, 30 + #HerbsList*30)
Frame2.Position = UDim2.new(0.8, -125, 0.5, -Frame2.Size.Y.Offset/2)
Frame2.BackgroundColor3 = Color3.fromRGB(25,25,25)
Frame2.Active = true
Frame2.Draggable = true

-- ปุ่มเปิด/ปิด AutoCollect
local AutoBtn = Instance.new("TextButton", Frame2)
AutoBtn.Size = UDim2.new(1,-20,0,25)
AutoBtn.Position = UDim2.new(0,10,0,5)
AutoBtn.Text = "AutoCollect : OFF"
AutoBtn.BackgroundColor3 = Color3.fromRGB(80,0,0)
AutoBtn.TextColor3 = Color3.new(1,1,1)

AutoBtn.MouseButton1Click:Connect(function()
    AutoEnabled = not AutoEnabled
    AutoBtn.Text = "AutoCollect : "..(AutoEnabled and "ON" or "OFF")
    AutoBtn.BackgroundColor3 = AutoEnabled and Color3.fromRGB(0,80,0) or Color3.fromRGB(80,0,0)
    if AutoEnabled then
        StarterPlayer:LoadCharacter()
    end
end)

-- ปุ่มเลือกพืช
local yPos = 35
for _,name in pairs(HerbsList) do
    local btn = Instance.new("TextButton", Frame2)
    btn.Size = UDim2.new(1,-20,0,25)
    btn.Position = UDim2.new(0,10,0,yPos)
    btn.Text = name.." : OFF"
    btn.BackgroundColor3 = Color3.fromRGB(80,0,0)
    btn.TextColor3 = Color3.new(1,1,1)
    yPos = yPos + 30

    btn.MouseButton1Click:Connect(function()
        HerbEnabled[name] = not HerbEnabled[name]
        btn.Text = name.." : "..(HerbEnabled[name] and "ON" or "OFF")
        btn.BackgroundColor3 = HerbEnabled[name] and Color3.fromRGB(0,80,0) or Color3.fromRGB(80,0,0)
    end)
end

-- ฟังก์ชัน AutoCollect
RunService.RenderStepped:Connect(function()
    if not LP.Character then return end
    HRP = LP.Character:FindFirstChild("HumanoidRootPart")
    if not HRP then return end

    local Herbs = Workspace:FindFirstChild("Herbs")
    if not Herbs then return end

    local nearestPart = nil
    local nearestDist = math.huge

    for _,part in ipairs(Herbs:GetDescendants()) do
        if part:IsA("BasePart") then
            if AutoEnabled and HerbEnabled[part.Name] then
                local dist = (HRP.Position - part.Position).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearestPart = part
                end
            end
        end
    end

    if nearestPart and AutoEnabled and not isTweening then
        isTweening = true
        local targetPos = nearestPart.Position + Vector3.new(0,3,0)
        local tInfo = TweenInfo.new((HRP.Position - targetPos).Magnitude / 70, Enum.EasingStyle.Linear)
        local tween = TweenService:Create(HRP, tInfo, {CFrame = CFrame.new(targetPos)})
        tween:Play()
        tween.Completed:Connect(function()
            isTweening = false
            local prompt = nearestPart:FindFirstChildWhichIsA("ProximityPrompt")
            if prompt then
                prompt:InputHoldBegin()
                task.wait(1)
                prompt:InputHoldEnd()
            end
        end)
    end
end)
