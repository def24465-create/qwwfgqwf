local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "VietNam_HUB",
    LoadingTitle = "Immortal Cultivation",
    LoadingSubtitle = "By VietNam_HUB",
    ConfigurationSaving = { Enabled = false }
})

local Tab = Window:CreateTab("Auto Collect", 4483362458)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local LP = Players.LocalPlayer

local HerbsList = {
    "Soul Berries",
    "Extreme Yang Grass",
    "Immortal Peach",
    "Ginseng",
    "Soothing Soul Root",
    "Sorrowful Poison Drip",
    "Jade Marrow Grass",
    "Extreme Yin Growth",
    "Heart Lotus"
}

local RealName = {
    ["Soul Berries"] = {"Soul Berries","Leaves"},
    ["Immortal Peach"] = {"Immortal Peach","Plane.002"},
    ["Extreme Yang Grass"] = {"Extreme Yang Grass"},
    ["Ginseng"] = {"Ginseng"},
    ["Soothing Soul Root"] = {"Soothing Soul Root"},
    ["Sorrowful Poison Drip"] = {"Sorrowful Poison Drip"},
    ["Jade Marrow Grass"] = {"Jade Marrow Grass"},
    ["Extreme Yin Growth"] = {"Extreme Yin Growth","WideFrondShrub_2"},
    ["Heart Lotus"] = {"Heart Lotus"}
}

local AutoEnabled = false
local HerbEnabled = {}
for _, v in ipairs(HerbsList) do HerbEnabled[v] = false end

Tab:CreateToggle({
    Name = "Auto Collect",
    CurrentValue = false,
    Callback = function(s)
        AutoEnabled = s
        if s then pcall(function() LP:LoadCharacter() end) end
    end
})

for _, herb in ipairs(HerbsList) do
    Tab:CreateToggle({
        Name = herb,
        CurrentValue = false,
        Callback = function(s)
            HerbEnabled[herb] = s
        end
    })
end

-- รองรับทั้ง Model และ Part
local function getHerbObjects(uiName)
    local folder = Workspace:FindFirstChild("Herbs")
    if not folder then return {} end

    local found = {}

    if uiName == "Soul Berries" or uiName == "Immortal Peach" or uiName == "Extreme Yin Growth" then
        for _, m in ipairs(folder:GetChildren()) do
            if m:IsA("Model") and m.Name == uiName then
                local pos = m:GetPivot().Position
                table.insert(found, {model = m, pos = pos})
            end
        end
        return found
    end

    for _, rn in ipairs(RealName[uiName]) do
        for _, obj in ipairs(folder:GetDescendants()) do
            if obj:IsA("BasePart") and (obj.Name == rn or obj.Parent.Name == rn) then
                table.insert(found, {model = obj, pos = obj.Position})
            end
        end
    end

    return found
end

local isTweening = false

task.spawn(function()
    while true do
        task.wait(0.15)
        if not AutoEnabled then continue end
        if not LP.Character then continue end

        local HRP = LP.Character:FindFirstChild("HumanoidRootPart")
        if not HRP then continue end

        local nearestObj, nearestPos, nearestDist = nil, nil, math.huge

        for uiName, enabled in pairs(HerbEnabled) do
            if enabled then
                local list = getHerbObjects(uiName)
                for _, data in ipairs(list) do
                    local d = (HRP.Position - data.pos).Magnitude
                    if d < nearestDist then
                        nearestDist = d
                        nearestObj = data.model
                        nearestPos = data.pos
                    end
                end
            end
        end

        if nearestObj and nearestPos and not isTweening then
            isTweening = true

            local goal = nearestPos + Vector3.new(0,3,0)
            local dist = (HRP.Position - goal).Magnitude
            local travelTime = dist / 70   -- ⭐ ไม่มีเร่งความเร็ว

            local tween = TweenService:Create(
                HRP,
                TweenInfo.new(travelTime, Enum.EasingStyle.Linear),
                {CFrame = CFrame.new(goal)}
            )
            tween:Play()

            tween.Completed:Once(function()
                task.wait(0.1)
                isTweening = false

                local prompt = nearestObj:FindFirstChildWhichIsA("ProximityPrompt", true)
                if prompt then
                    pcall(function()
                        prompt:InputHoldBegin()
                        task.wait(2.5)
                        prompt:InputHoldEnd()
                    end)
                else
                    for _, d in ipairs(nearestObj:GetDescendants()) do
                        if d:IsA("ClickDetector") then
                            pcall(function() fireclickdetector(d) end)
                        end
                    end
                end
            end)
        end
    end
end)
